<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
{{include GameSlot Head}}

<body class="vn2">
    {{using GameSlot.Types}}
    {{using GameSlot.Database}}
    {{set Lottery Lottery = (Lottery) PageData["Lottery"]}}
    {{set List<Bet> Bets = (List<Bet>) PageData["Bets"]}}
    {{set List<TopItem> TopItems = (List<TopItem>) PageData["TopItems"]}}
    {{set bool ItsWinner = (bool) PageData["ItsWinner"]}}
    {{set bool ItsHistory = (bool) PageData["ItsHistory"]}}
    {{set string Game = (string) PageData["Game"]}}
    <script>
        var jackpot_price_str = "{{=Lottery.JackpotPrice_Str}}";
        var auth = false;
        LotteryPageConnect = true;
        LotteryPage_LotteryID = "{{=Lottery.ID}}";

        {{if(Helper.UserHelper.Authorized(client))}}
            LotteryPage_GetInventory = true;
            LotteryPage_GetInventory_SteamGameID = "{{=Lottery.SteamGameID}}";
            LOCAL_INVENTORY_ITEMS_NUM = 36;
        {{end}}

        var left_secs = "{{=Lottery.LeftTime}}";
        var mins = 0;
        var secs = 0;

        timer();
        var def_timer_interval = setInterval(timer, 1000);
        function timer()
        {
            if (left_secs >= 0) {
                mins = Math.floor(left_secs / 60);
                secs = left_secs - 60 * mins;

                if (secs < 10) {
                    $("#lot_secs").text("0" + secs);
                }
                else {
                    $("#lot_secs").text(secs);
                }

                if (mins < 10) {
                    $("#lot_mins").text("0" + mins);
                }
                else {
                    $("#lot_mins").text(mins);
                }

                left_secs = left_secs - 1;
            }
        }

        var ower_left_secs = "{{=Lottery.LeftTimeNextGame}}";
        var ower_mins = Math.floor(ower_left_secs / 60);
        var ower_secs = ower_left_secs - 60 * mins;

        ower_timer();
        var ower_timer_interval = setInterval(ower_timer, 1000);
        function ower_timer()
        {
            if (ower_secs >= 0) 
            {
                if (ower_secs < 10) {
                    $("#ower_secs").text("0" + ower_secs);
                }
                else {
                    $("#ower_secs").text(ower_secs);
                }

                if (ower_mins < 10) {
                    $("#ower_mins").text("0" + ower_mins);
                }
                else {
                    $("#ower_mins").text(ower_mins);
                }

                ower_secs = ower_secs-1;
            }
            else
            {
                $("div#ower_timer").html('<a href="" class="new-game">Новая игра</a>');
                clearInterval(ower_timer_interval);
            }
        }
    </script>

	<div id="page">
        {{include GameSlot UpHeader}}

        <div class="ft-img1"><span>
            {{if(Lottery.SteamGameID == Configs.DOTA2_STEAM_GAME_ID)}}
                <img src="/cached_files/img/b2.png" alt="">
            {{end}}
            {{else if(Lottery.SteamGameID == Configs.CSGO_STEAM_GAME_ID)}}
                <img src="/cached_files/img/b3.png" alt="">
            {{end}}
        </span></div>

        {{include GameSlot Header}}

        {{if(Lottery.LeftTime < 0 && Lottery.UsersCount == 0)}}
            <div class="pl-big-st1" id="lottery_standart_form">
                <div class="bg-dsk1">
                    <i></i>
                    <div></div>
                </div>
                <div class="fk1"></div>
                <div class="fk2"></div>
                <div class="fk3"></div>
                <div class="cont-pl1">
                    <div class="tb-m1">
                        <div class="numb1">
                            <div><span>Номер<br>Игры</span></div>
                            <i>#{{=Lottery.IDStr}}</i>
                        </div>
                        <div class="dj1">
                            <div><span>Джек<br>пот</span></div>
                            <i class="numb2"><b>0</b> предметов</i>
                        </div>
                        <div class="dj2">
                            <div><span></span></div>
                            <i class="">0</i>
                        </div>
                        <div class="action-chet1">
                            <div class="tit-chet1">Ожидание первой ставки</div>
                            <div class="ch-tt1"><span id="lot_secs">03</span><i>:</i><span id="lot_mins">00</span></div>
                            {{if(!Helper.UserHelper.Authorized(client))}}
                                <a href="/login" class="start-game1">Начать игру</a>
                            {{end}}
                            {{else}}
                                <a href="" class="start-game1" onclick="return open_bet();">Начать игру</a>
                            {{end}}
                        </div>
                        <div class="r-text1">
                            <div class="ep-tit1"><span>Правила:</span><a href="/bet-info" target="_blank">Подробнее</a></div>
                            <p class="j1">Чем выше стоимость ставки, тем больше<br>шанс победы</p>
                            <p class="j2">Минимальная цена предмета — {{=Configs.MIN_ITEMS_PRICE * Helper.Rub_ExchangeRate}} руб.</p>
                            <p class="j3">Максимальная разовая ставка — 24 предмета</p>
                            <p class="j4">Когда поступает новый взнос, то к таймеру прибавляется дополнительное время в процентном соотношении внесенной суммы от суммы банка.<br />Максимальный лимит времени — 3 минуты.</p>
                        </div>
                    </div>
                    <div class="nav-st1">
                        <a href="/fair-play" target="_blank">Принципы честной игры</a>
                        <span>Хэш раунда:</span>
                        <i>{{=Lottery.RaundNumber_MD5}}</i>
                    </div>
                </div>
            </div>
        {{end}}
        {{else if(Lottery.LeftTime != 0)}}
            <div class="pl-big-st1 pl-big-st11 pl-big-st112" id="lottery_started_format">
                <div class="bg-dsk1">
                    <i></i>
                    <div></div>
                </div>
                <div class="fk1"></div>
                <div class="fk4"></div>
                <div class="fk5"></div>
                <div class="fk6"></div>
                <div class="cont-pl1">
                    <div class="tb-m1">
                        <div class="numb1">
                            <div><span>Номер<br>Игры</span></div>
                            <i>#{{=Lottery.IDStr}}</i>
                        </div>
                        <div class="dj1">
                            <div><span>Джек<br>пот</span></div>
                            <i class="numb2"><b id="jackpot_items_num">{{=Lottery.JackpotItems}}</b> предметов</i>
                            <b class="eft-pl1 items_jackpot_alert"></b>
                        </div>
                        <div class="dj2">
                            <div><span></span></div>
                            <i class="" id="jackpot_price">{{=Lottery.JackpotPrice_Str}}</i>
                            <b class="eft-pl1 price_jackpot_alert"></b>
                        </div>
                        <div class="action-chet1">
                            {{if(Lottery.UsersCount > 1)}}
                                <div class="tit-chet1">Начнется через:</div>
                                {{set int Minutes = (Lottery.LeftTime / 60)}}
                                {{set int Sec = Lottery.LeftTime - 60 * Minutes}}
                                <div class="ch-tt1"><span id="lot_mins">0{{=Minutes}}</span><i>:</i>
                                <span id="lot_secs">
                                    {{if(Sec < 10)}}
                                        0{{=Sec}}
                                    {{end}}
                                    {{else}}
                                        {{=Sec}}
                                    {{end}}
                                </span></div>
                            {{end}}
                            {{else}}
                                <div class="tit-chet1">Ожидание второго игрока</div>
                                <div class="ch-tt1"><span id="lot_mins">03</span><i>:</i><span id="lot_secs">00</span></div>
                            {{end}}
                            <b class="eft-pl1 lottery_time_alert"></b>
                            {{if(!Helper.UserHelper.Authorized(client))}}
                                <a href="/login" class="start-game1 start-game11">Принять участие</a>
                            {{end}}
                            {{else}}
                                <a href="" class="start-game1 start-game11" onclick="return open_bet();">Принять участие</a>
                            {{end}}
                        </div>
                        <div class="r-text1">
                            <div class="ep-tit1"><span>Правила:</span><a href="/bet-info" target="_blank">Подробнее</a></div>
                            <p class="j1">Чем выше стоимость ставки, тем больше<br>шанс победы</p>
                            <p class="j2">Минимальная цена предмета — {{=Configs.MIN_ITEMS_PRICE * Helper.Rub_ExchangeRate}} руб.</p>
                            <p class="j3">Максимальная разовая ставка — 24 предмета</p>
                            <p class="j4">Когда поступает новый взнос, то к таймеру прибавляется дополнительное время в процентном соотношении внесенной суммы от суммы банка.<br />Максимальный лимит времени — 3 минуты.</p>
                        </div>
                    </div>

                    <div class="nav-st1">
                        <a href="/fair-play" target="_blank">Принципы честной игры</a>
                        <span>Хэш раунда:</span>
                        <i>{{=Lottery.RaundNumber_MD5}}</i>
                    </div>

                    <div class="bl-sld-bi1">
                        <div class="tt1">Самые крутые предметы розыгрыша:</div>
                        <div class="tt2">Топ</div>
                        <div class="owl1 owl-carousel owl-theme" id="best_items_list">

                            {{foreach(TopItem Item in TopItems)}}
                            <div class="item">
                                <div class="item-ic-t1">
                                    <img src="{{=Item.Image}}" alt="{{=Item.Name}}">
                                    <span class="">{{=Item.Price_Str}}</span>
                                    <a href=""></a>
                                    {{if(Item.Rarity != null)}}
                                        <div class="tiltp"><itm style="color:#{{=Item.Color}}">{{=Item.Name}}</itm><br />
                                        <itm style="color:{{=Item.RarityColor}}">{{=Item.Rarity}}</itm></div>
                                    {{end}}
                                    {{else}}
                                        <div class="tiltp">{{=Item.Name}}</div>
                                    {{end}}
                                </div>
                            </div>
                            {{end}}

                        </div>
                    </div>
                </div>
            </div>
        {{end}}
        {{else}}
            {{set string LOT_DONE = "display:block;"}}
            {{if(Lottery.LeftTimeNextGame > 0)}}
                {{edit LOT_DONE = "display:none;"}}
                <script>
                    IGNORE_LOTTERY_ROULETTE_AUTO_UPDATE = true;
                    sound_bet_come();
                </script>
                <div id="lottery_roulette_format">
                    <div class="pl-big-st1 pl-big-st13">
                        <div class="bg-dsk1">
                            <i></i>
                            <div></div>
                        </div>
                        <div class="fk4 fk41"></div>
                        <div class="fk5"></div>
                        <div class="fk6 fk61"></div>
                        <div class="fk10"></div>
                        <div class="cont-pl1">
                            <div class="bt-con-numb1">
                                <div class="numb1">
                                    <div><span>Номер<br>Игры</span></div>
                                    <i>{{=Lottery.IDStr}}</i>
                                </div>
                                <div class="dj1">
                                    <div><span>Джек<br>пот</span></div>
                                    <i class="numb2"><b>{{=Lottery.JackpotItems}}</b> предметов</i>
                                </div>
                                <div class="dj2">
                                    <div><span></span></div>
                                    <i class="rub1">{{=Lottery.JackpotPrice_Str}}</i>
                                </div>
                            </div>
                            <div class="bg-stl1">
                                <div class="line1">
                                    <div class="ov-elem1 j1">
                                        {{foreach(LotteryRouletteData RouData in Helper.LotteryHelper.GetLotteryRouletteData(Lottery.SteamGameID))}}
                                            {{if(RouData.Winner == 1)}}
                                                <div dt='{{=RouData.Token.ToString("00000000")}}' class='item1 win1'><img src='{{=RouData.UsersAvatar}}'></div>
                                            {{end}}
                                            {{else}}
                                                <div dt='{{=RouData.Token.ToString("00000000")}}' class='item1'><img src='{{=RouData.UsersAvatar}}'></div>
                                            {{end}}
                                        {{end}}
                                    </div>
                                </div>
                                <div class="line2">
                                    <div class="ov-elem1 j2"></div>
                                </div>
                                <div class="line3">
                                    <div class="ov-elem1 j3"></div>
                                </div>
                                <div class="win-bl1"></div>
                            </div>
                            <div class="rt-con-bottom1">
                                <div class="lt-l1">
                                    <div><span>Число судьбы: {{=Lottery.RaundNumber}}</span></div>
                                    <a href="/fair-play" target="_blank" class="lnk1">Принципы честной игры</a>
                                </div>
                                <div class="rr-chet1">00000000</div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
                <script>
                    /* trash code start */
                    $('.ov-elem1.j1 .item1').each(function () {
                        $(this).clone().appendTo('.ov-elem1.j3');
                        $(this).clone().prependTo('.ov-elem1.j2');
                    });
                    sp3 = $('.ov-elem1.j2 .item1').length - $('.ov-elem1.j2 .item1.win1').index() - 6;
                    $('.ov-elem1').width($('.ov-elem1.j1 .item1').length * 108);
                    sp2 = $('.ov-elem1.j1 .item1').length;
                    j3 = $('.ov-elem1.j1 .item1').length - 1;
                    /* trash code end */
                    rull();
                    rrch();
                </script>
            {{end}}

            <div class="pl-big-st1 pl-big-st11 pl-big-st112" id="lottery_end_format" style="{{=LOT_DONE}}">
                <div class="bg-dsk1">
                    <i></i>
                    <div></div>
                </div>
                <div class="fk1 fk111"></div>
                <div class="fk5"></div>
                <div class="fk14"></div>
                {{if(ItsWinner)}}
                    <div class="fk15"></div>
                {{end}}
                {{else}}
                    <div class="fk15 fk151"></div>
                {{end}}
                <div class="cont-pl1">
                    <div class="game-over-s1">
                        <div class="ll1">
                            <div class="tl1"><span>Номер<br>Игры</span><div>{{=Lottery.IDStr}}</div></div>
                            <div class="tl3">Хэш раунда: <span>{{=Lottery.RaundNumber_MD5}}</span></div>
                            <div class="tl2"><span>Победный<br>жетон</span><i>{{=Lottery.WinnersToken}}</i></div>
                            <div class="tl4">
                                <div>Честная игра</div>
                                <p><i></i>{{=Lottery.RaundNumber}} <span>(Число судьбы)</span></p>
                                <p><i>х</i>{{=Lottery.CentBank}} <span>(Банк в центах)</span></p>
                                <p><i>=</i>{{=Lottery.WinnersToken}} <span>(Победный жетон)</span></p>
                            </div>
                        </div>
                        {{if(ItsWinner)}}
                        <div class="rr1 rr11">
                        {{end}}
                        {{else}}
                        <div class="rr1 rr11 rr111">
                        {{end}}
                            <div class="tf1 tf11">
                                <div class="tfs1">Сорвал джекпот</div>
                                <div class="tf2"><span>{{=Lottery.JackpotItems}}</span>предметов</div>
                                <div class="tf3">{{=Lottery.JackpotPrice_Str}}</div>
                                {{if(ItsWinner)}}
                                    <p id="msg_to_winner">Все предметы перемещены<br>в ваш временный <a href="/inventory/{{=PageData["Game"]}}">инвентарь</a></p>
                                {{end}}
                            </div>
                            <div class="td1">
                                <div class="eo1">
                                    <span>победил<br>с шансом:</span>
                                    <div>{{=Lottery.Wonrate}}%</div>
                                </div>
                                <div class="eo2">
                                    <span>Поставил:</span>
                                    <div><i class="j1"><b>{{=Lottery.WinnersBetItemsNum}}</b> предметов</i><i class="j2"><b>{{=Lottery.WinnersBetPrice_Str}}</b></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="ct-game-over1 ct-game-over11">
                            <div class="ev-ft1">
                                <div class="tit-game-over1">Игра окончена</div>
                                <a href="" onclick="return GetUsersProfile({{=Lottery.Winner.ID}});">
                                    <div class="win-bl1"><div><img src="{{=Lottery.Winner.Avatar}}" alt="{{=Lottery.Winner.Name}}"></div></div>
                                </a>
                                <div class="np-ett1">{{=Lottery.Winner.Name}}</div>
                                {{if(ItsHistory)}}
                                    <a href="/games-history/{{=Game}}" class="new-game">НАЗАД</a>
                                {{end}}
                                {{else}}
                                    <a href="/game/{{=Game}}" class="new-game">Новая игра</a>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{end}}

        {{if(Lottery.WinnersToken <= 0)}}
            <div style="display:none;" id="lottery_started_format">
                <div class="pl-big-st1 pl-big-st11 pl-big-st112">
                    <div class="bg-dsk1">
                        <i></i>
                        <div></div>
                    </div>
                    <div class="fk1"></div>
                    <div class="fk4"></div>
                    <div class="fk5"></div>
                    <div class="fk6"></div>
                    <div class="cont-pl1">
                        <div class="tb-m1">
                            <div class="numb1">
                                <div><span>Номер<br>Игры</span></div>
                                <i>#{{=Lottery.IDStr}}</i>
                            </div>
                            <div class="dj1">
                                <div><span>Джек<br>пот</span></div>
                                <i class="numb2"><b id="jackpot_items_num">0</b> предметов</i>
                                <b class="eft-pl1 items_jackpot_alert"></b>
                            </div>
                            <div class="dj2">
                                <div><span></span></div>
                                <i class="" id="jackpot_price">0</i>
                                <b class="eft-pl1 price_jackpot_alert"></b>
                            </div>
                            <div class="action-chet1">
                                <div class="tit-chet1">Начнется через:</div>
                                <div class="ch-tt1"><span id="lot_mins">03</span><i>:</i>
                                <span id="lot_secs">00</span></div>
                                <b class="eft-pl1 lottery_time_alert"></b>
                                {{if(!Helper.UserHelper.Authorized(client))}}
                                    <a href="/login" class="start-game1 start-game11">Принять участие</a>
                                {{end}}
                                {{else}}
                                    <a href="" class="start-game1 start-game11" onclick="return open_bet();">Принять участие</a>
                                {{end}}
                            </div>
                            <div class="r-text1">
                                <div class="ep-tit1"><span>Правила:</span><a href="/bet-info" target="_blank">Подробнее</a></div>
                                <p class="j1">Чем выше стоимость ставки, тем больше<br>шанс победы</p>
                                <p class="j2">Минимальная цена предмета — {{=Configs.MIN_ITEMS_PRICE * Helper.Rub_ExchangeRate}} руб.</p>
                                <p class="j3">Максимальная разовая ставка — 24 предмета</p>
                                <p class="j4">Когда поступает новый взнос, то к таймеру прибавляется дополнительное время в процентном соотношении внесенной суммы от суммы банка.<br />Максимальный лимит времени — 3 минуты.</p>
                            </div>
                        </div>

                        <div class="nav-st1">
                            <a href="/fair-play" target="_blank">Принципы честной игры</a>
                            <span>Хэш раунда:</span>
                            <i>{{=Lottery.RaundNumber_MD5}}</i>
                        </div>

                        <div class="bl-sld-bi1">
                            <div class="tt1">Самые крутые предметы розыгрыша:</div>
                            <div class="tt2">Топ</div>
                            <div class="owl1 owl-carousel owl-theme" id="best_items_list">

                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div id="lottery_roulette_format" style="display:none;">
                <div class="pl-big-st1 pl-big-st13">
                    <div class="bg-dsk1">
                        <i></i>
                        <div></div>
                    </div>
                    <div class="fk4 fk41"></div>
                    <div class="fk5"></div>
                    <div class="fk6 fk61"></div>
                    <div class="fk10"></div>
                    <div class="cont-pl1">
                        <div class="bt-con-numb1">
                            <div class="numb1">
                                <div><span>Номер<br>Игры</span></div>
                                <i>{{=Lottery.IDStr}}</i>
                            </div>
                            <div class="dj1">
                                <div><span>Джек<br>пот</span></div>
                                <i class="numb2"><b id="jackpot_items">0</b> предметов</i>
                            </div>
                            <div class="dj2">
                                <div><span></span></div>
                                <i class="rub1" id="jackpot_price">0</i>
                            </div>
                        </div>
                        <div class="bg-stl1">
                            <div class="line1">
                                <div class="ov-elem1 j1" id="users_ball">
                                
                                </div>
                            </div>
                            <div class="line2">
                                <div class="ov-elem1 j2"></div>
                            </div>
                            <div class="line3">
                                <div class="ov-elem1 j3"></div>
                            </div>
                            <div class="win-bl1"></div>
                        </div>
                        <div class="rt-con-bottom1">
                            <div class="lt-l1">
                                <div id="raund_number"><span>Число судьбы: </span></div>
                                <a href="/fair-play" target="_blank" class="lnk1">Принципы честной игры</a>
                            </div>
                            <div class="rr-chet1">00000000</div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>

            <div class="pl-big-st1 pl-big-st11 pl-big-st112" id="lottery_end_format" style="display:none">
                <div class="bg-dsk1">
                    <i></i>
                    <div></div>
                </div>
                <div class="fk1 fk111"></div>
                <div class="fk5"></div>
                <div class="fk14"></div>
                <div class="fk15 fk151"></div>
                <div class="cont-pl1">
                    <div class="game-over-s1">
                        <div class="ll1">
                            <div class="tl1"><span>Номер<br>Игры</span><div>#{{=Lottery.IDStr}}</div></div>
                            <div class="tl3">Хэш раунда: <span><own id="hash_number"></own></span></div>
                            <div class="tl2"><span>Победный<br>жетон</span><i><own id="winners_token"></own></i></div>
                            <div class="tl4">
                                <div>Честная игра</div>
                                <p><i></i><own id="raund_number"></own> <span>(Число судьбы)</span></p>
                                <p><i>х</i><own id="bank_cent"></own> <span>(Банк в центах)</span></p>
                                <p><i>=</i><own id="winners_token"></own> <span>(Победный жетон)</span></p>
                            </div>
                        </div>
                        <div class="rr1 rr11 rr111">
                            <div class="tf1 tf11">
                                <div class="tfs1">Сорвал джекпот</div>
                                <div class="tf2"><span id="jackpot_items"></span>предметов</div>
                                <div class="tf3" id="jackpot_price"></div>
                                <p id="msg_to_winner" style="display:none;">Все предметы перемещены<br>в ваш временный <a href="/inventory/{{=PageData["Game"]}}">инвентарь</a></p>
                            </div>
                            <div class="td1">
                                <div class="eo1">
                                    <span>победил<br>с шансом:</span>
                                    <div id="winners_wonrate"></div>
                                </div>
                                <div class="eo2">
                                    <span>Поставил:</span>
                                    <div><i class="j1"><b id="winners_bet_items_num"></b> предметов</i><i class="j2"><b id="winners_bet_price"></b></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="ct-game-over1 ct-game-over11">
                            <div class="ev-ft1">
                                <div class="tit-game-over1">Игра окончена</div>
                                <a href="" id="won_open_winners_profile">
                                    <div class="win-bl1"><div><img src="" alt="" id="winners_avatar"></div></div>
                                </a>
                                <div class="np-ett1" id="winners_name"></div>
                                <a href="" class="new-game">Новая игра</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{end}}

        <div id="best_items_html" style="display:none;">
            <div class="item">
                <div class="item-ic-t1">
                    [image]
                    <span class="">[price]</span>
                    <a href=""></a>
                    <div class="tiltp">[name]</div>
                </div>
            </div>
        </div>
        <div id="new_bets_items" style="display:none;">
            <div class="item1">
                <img src="/[items_image]" alt="[items_name]">
                <span class="">[items_price]</span>
                <div class="tiltp">[items_name]</div>
            </div>
        </div>
        <div id="new_bet" style="display:none;">
            <div class="bl-ov-et1 ya2" id="user_id_[USER_ID]">
                <div class="bg-bl-ov1">
                    <div></div>
                </div>
                <div></div>
                <div class="head-bl-et1">
                    <a href="" onclick="return GetUsersProfile([USER_ID]);">
                        <div class="av-ll1">
                            <img [user_avatar] alt="[USER_NAME_2]">
                            <div>
                                <div>
                                    <span>[USER_NAME]</span>
                                    <i>[hangout_text]</i>
                                    <b id="hangout_user">[hangout_user]</b>
                                </div>
                            </div>
                        </div>
                    </a>
                    <div class="bl-st2">
                        <div class="evr1">
                            <a class="j1" style="margin-left:30px;">[BET_ITEMS_NUM]</a>
                            <a class="j2 ">[BET_PRICE]</a>
                            <a class="j3">[FIRST_TOKEN]-[LAST_TOKEN]</a>
                        </div>
                    </div>

                    <div class="ov-rr1">
                        <div class="over-lt-rt1">
                            <div class="lt1">
                                <p><span>Ставок:</span><i class="j1" id="bets_num">[BETS_NUM]</i></p>
                                <p><span>Всего:</span><i class="j2" id="total_items_num">[TOTAL_ITEMS_NUM]</i></p>
                            </div>
                            <div class="rt1">
                                <p><span>Шанс победы:</span><i class="j3" id="winrate">[WINRATE]%</i></p>
                                <p><i class="j4" id="total_price">[TOTAL_PRICE]</i></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ov-ic-more-s1">[BETS_ITEMS]</div>
            </div>
        </div>

        {{if(Bets.Count > 0)}}
            <section id="content2" class="mb-t1">
        {{end}}
        {{else}}
            <section id="content2" class="">
        {{end}}
            <span id="first_position" style="display:none;"></span>
            {{if(Bets.Count > 0)}}
                {{foreach(Bet bet in Bets)}}
                    <div class="bl-ov-et1 ya2" id="user_id_{{=bet.XUser.ID}}">
                        <div class="bg-bl-ov1">
                            <div></div>
                        </div>
                        <div></div>
                        <div class="head-bl-et1">
                            <a href="" onclick="return GetUsersProfile({{=bet.XUser.ID}});">
                                <div class="av-ll1">
                                    <img src="{{=bet.XUser.Avatar}}" alt="{{=bet.XUser.Name}}">
                                    <div>
                                        <div>
                                            <span>{{=bet.XUser.Name}}</span>
                                            {{if(bet.XUser.GroupOwnerID >= 0)}}
                                                <i>Тусовка:</i>
                                                <b>{{=Helper.GroupHelper.SelectByID((uint)bet.XUser.GroupOwnerID).Name}}</b>
                                            {{end}}
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <div class="bl-st2">
                                <div class="evr1">
                                    <a class="j1">{{=bet.ItemsNum}}</a>
                                    <a class="j2">{{=bet.Price_Str}}</a>
                                    <a class="j3">{{=bet.FirstToken.ToString("D8")}}-{{=bet.LastToken.ToString("D8")}}</a>
                                </div>
                            </div>

                            <div class="ov-rr1">
                                <div class="over-lt-rt1">
                                    <div class="lt1">
                                        <p><span>Ставок:</span><i class="j1" id="bets_num">{{=bet.BetsNum}}</i></p>
                                        <p><span>Всего:</span><i class="j2" id="total_items_num">{{=bet.TotalItemsNum}}</i></p>
                                    </div>
                                    <div class="rt1">
                                        <p><span>Шанс победы:</span><i class="j3" id="winrate">{{=bet.Winrate}}%</i></p>
                                        <p><i class="j4" id="total_price">{{=bet.TotalPrice_Str}}</i></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ov-ic-more-s1">            
                            {{foreach(Chip chip in bet.Chips)}}
                                <div class="item1">
                                    <img src="/chip-image/{{=chip.ID}}">
                                    <span class="">{{=chip.Cost_Str}}</span>
                                    <div class="tiltp">Фишка на сумму {{=Helper.ChipHelper.SelectByID(chip.ID).Cost}}$</div>
                                </div>
                            {{end}}

                            {{foreach(USteamItem Item in bet.SteamItems)}}
                                <div class="item1">
                                    <img src="/steam-image/{{=Item.SteamGameID}}/{{=Item.ID}}" alt="{{=Item.Name}}">
                                    <!--<img src="{{=Item.Image}}" alt="{{=Item.Name}}">-->
                                    <span class="">{{=Item.Price_Str}}</span>
                                    <div class="tiltp"><itm style="color:#{{=Item.Color}}">{{=Item.Name}}</itm><br /><itm style="color:{{=Item.RarityColor}}">{{=Item.Rarity}}</itm></div>
                                </div>
                            {{end}}
                        </div>

                    </div>
                {{end}}
            <!--<a href="" class="show-more-items1">Показать ещё</a>-->
            {{end}}
        </section>

        <div class="bt-ov-ft1 mb-t2">
            <div class="item1">
                <div class="et-tt1">Максимальный джекпот за всё время:</div>
                <div class="sp-con1">
                    <div class="j1">{{=PageData["MaxJackpot"]}}</div>
                    <div class="j2">{{=PageData["MaxJackpotItems"]}} <span>предметов</span></div>
                </div>
            </div>
            <div class="item1">
                <div class="et-tt1 j1">Сегодня сыграно</div>
                <div class="sp-con1 j1">
                    <div class="j3">{{=PageData["TodaysGames"]}} <b>игр</b></div>
                </div>
            </div>
            <div class="item1">
                <div class="et-tt1">Максимальный джекпот за Сегодня:</div>
                <div class="sp-con1">
                    <div class="j1">{{=PageData["TodaysJackpotPrice"]}}</div>
                    <div class="j2">{{=PageData["TodaysJackpotItems"]}} <span>предметов</span></div>
                </div>
            </div>
        </div>

        <div class="ev-foot1"></div>
        {{include GameSlot Footer}}
    </div>
    <div class="up1"></div>

    {{if(Helper.UserHelper.Authorized(client))}}
    {{set List<Chip> Chips = (List<Chip>) PageData["Chips"]}}
    {{set XUser user = (XUser) PageData["User"]}}
    {{set double UsersBetsPrice = (double) PageData["UsersBetsPrice"]}}

    <div id="steam_items_html" style="display:none;">
        <div class="item1" id="item_id_[item_unique_id]">
            <span style="display:none;" id="iventory_id">[iventory_id]</span>
            <span style="display:none;" id="current_iventory_id">[current_iventory_id]</span>
            <span style="display:none;" id="item_assert_id">[item_assert_id]</span>
            <span style="display:none;" id="item_id">[item_id]</span>

            [item_steam_image]
            <span class="" id="item_price">[item_price]</span>

            <a href="" onclick="return hh([item_assert_id], [iventory_id]);"></a>
            <div class="tiltp">[item_name]</div>  
        </div>    
    </div>

    <div class="modal" id="bet_sys">
        <div class="modal-tb">
            <div class="bg-modal"></div>
            <div class="modal-con">
                <div class="close1">Закрыть</div>
                <div class="title-f1">Сделай свою ставку</div>
                <div class="sz1-modal1">
                    <div class="ll1">
                        <div class="tit-rt1">
                            <div class="bl-rr1">
                                <span>Суммарный<br>шанс победы:</span>
                                <div id="users_win_rate">0%</div>
                            </div>
                            <div class="ep-rt1">Игровая ставка</div>
                        </div>
                        <div class="ov-bl1">
                            <div class="bg-ov-bl1"><div></div></div>
                            <div class="tit-bl1">
                                <div class="ef1" id="current_bet_items_num">0</div>
                                <div class="ef2">Суммарная<br>стоимость:</div>
                                <div class="ef3" id="current_bet_price">0</div>
                            </div>
                            <div class="cont-ov-items-more1 more24" id="bet_iventory">
                                <!--ITEMS HERE -->
                            </div>
                            <div class="over-pt1">
                                <p class="pt1">Если часть предметов поставлена из steam-инвентаря, то<br>ставка займёт определённое время, пока вещи будут<br>переданы боту</p>
                            </div>
                            <a href="" class="go-now-game1" onclick="return SetBet();">Поставить</a>

                            <div class="ready-pp1" id="bet_ready" style="display:none;">
                                <div class="df-pp2">
                                    <img src="/cached_files/img/9-6_2_obrabotka-stavki_loading_icon.gif" alt=""><span>Идёт обработка<br>ставки</span>
                                </div>
                            </div>

                            <div class="ready-pp1" id="bet_done" style="display:none;">
                                <div class="df-pp1">
                                    <div class="y2">Ваша сделка готова!</div>
                                    <div class="vt-tb1">
                                        <p><span>Код защиты:</span>[bet_done_protection_code]</p>
                                        <p><span>Ник бота:</span>[bet_done_bot_name]</p>
                                    </div>
                                    <div class="y3">Для подтверждения сделки<br>перейдите в обмен Steam</div>
                                    <a href="" target="_blank" class="go-steam1" id="steam_trade_btn">Перейти в Steam</a>
                                </div>
                            </div>

                            <div class="ready-pp1" id="bet_item_not_found" style="display:none;">
                                <div class="df-pp3">
                                    <img src="/cached_files/img/not-found-error1.png" alt=""><span>К сожалению бот не нашел<br>предметы в вашем инвентаре</span>
                                    <a href="" onclick="return try_again();">повторить попытку</a>
                                </div>
                            </div>

                            <div class="ready-pp1" id="bet_wtf_error" style="display:none;">
                                <div class="df-pp3">
                                    <span>Что-то пошло не так. <br /> Повторите попытку</span>
                                    <a href="" onclick="return try_again();">повторить попытку</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="rr1">
                        <div class="ft-nav1">
                            <ul>
                                <li class="active"><a href="">Инвентарь Steam</a></li>
                                <li><a>Временный инвентарь</a></li>
                                <li><a href="">Фишки</a></li>
                            </ul>
                        </div>
                        <div class="ft-cont-ev1">
                            <div class="over-tt-item1 active">
                                <!-- STEAM INVENTORY -->
                                <div class="ov-bl1">
                                    <div class="bg-ov-bl1"><div></div></div>
                                    <div class="tit-bl1">

                                        <div class="pl-search-st1">
                                            <p>Чтобы передавать вещи из Steam-инвентаря, вы должны правильно указать свой Steam URL</p>
                                            {{if(user.TradePartner == 0 || user.TradeToken.Length == 0)}}
                                                <div class="frm-sml1 err" id="steam_trade_form">
                                                    <div><input type="text" id="steam_trade_url" placeholder="https://steamcommunity.com/tradeoffer/new/?partner=139041672&amp;token=IHERy8ya"></div>
                                                    <span id="trade_url_btn" class="active">Сохранить<input type="submit" value="" onclick="UpdateTradeURL();"></span>
                                                </div>
                                                <div class="st-q1 j1" id="trade_url_error">Не указан ваш Steam Trade URL!</div>
                                                <div class="st-q1 j2" style="display:none;" id="trade_url_ok"></div>
                                            {{end}}
                                            {{else}}
                                                <div class="frm-sml1">
                                                    <div><input type="text" id="steam_trade_url" value='https://steamcommunity.com/tradeoffer/new/?partner={{=user.TradePartner}}&token={{=user.TradeToken}}'></div>
                                                    <span id="trade_url_btn" class="active">Сохранить<input type="submit" value="" onclick="UpdateTradeURL();"></span>
                                                </div>
                                                <div class="st-q1 j1" style="display:none;" id="trade_url_error"></div>
                                                <div class="st-q1 j2" style="display:none;" id="trade_url_ok"></div>
                                            {{end}}

                                            <div class="clear"></div>
                                        </div>

                                        <div class="ef1" id="steam_inventory_items_num">0</div>
                                        <div class="ef2">Суммарная<br>стоимость:</div>
                                        <div class="ef3" id="steam_inventory_total_price">0</div>
                                        <div class="ef4">отображаются только те вещи,<br>которые доступны для ставки!</div>
                                    </div>
                                    <div class="search1">
                                        <div class="srh1" id="search_in_steam_inventory_srch">
                                            <input type="text" placeholder="Поиск по инвентарю" id="search_in_steam_inventory">
                                            <input type="submit" value="">
                                        </div>
                                        <div class="rr-sort1">
                                            <ul>
                                                <li>Сортировка:</li>
                                                <li id="inventory_sort_by_high_price" class="active"><a onclick="return SortInventoryByLowPrice(30, 0);">Сперва дорогие</a></li>
                                                <li id="inventory_sort_by_low_price"><a href="" onclick="return SortInventoryByLowPrice(30, 1);">Сперва дешевые</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div id="steam_inventory_closed" style="display:none;">
                                        <div class="dc-hide-error1">
                                            <div class="dc-f1">
                                                <div class="ev-error1">
                                                    <div>
                                                        <p>Для того, чтобы подгрузить ваши<br>предметы из Steam, вы должны<br><a href="">открыть инвентарь</a> в настройках.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="cont-ov-items-more1 cont-ov-items-more11" id="steam_iventory" dt="0"></div>

                                    <div class="modal-page-s1" id="steam_inventory_pagination" style="display:none;">
                                        <ul>
                                            <li><a href="" onclick="return Inventory_GetFirstPage(30);" id="first">В начало</a></li>
                                            <li><a href="" onclick="return Inventory_GetBeforePage(30);" id="before">Предыдущая</a></li>
                                            <li><a href="" onclick="return Inventory_GetNextPage(30);" id="next">Следующая</a></li>
                                            <li><a href="" onclick="return Inventory_GetLastPage(30);" id="last">В конец</a></li>
                                        </ul>
                                    </div>

                                    <div class="ready-pp1" id="steam_inventory_loading">
                                        <div class="df-pp2 df-pp22">
                                            <img src="/cached_files/img/9-6_2_obrabotka-stavki_loading_icon.gif" alt=""><span class="j1">Идёт загрузка<br>инвентаря</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="over-tt-item1">
                                <div class="ov-bl1">
                                    <div class="bg-ov-bl1"><div></div></div>
                                    <div class="tit-bl1">
                                        <div class="ef1" id="local_steam_inventory_items_num">0</div>
                                        <div class="ef2">Суммарная<br>стоимость:</div>
                                        <div class="ef3" id="local_steam_inventory_total_price">0</div>
                                        <div class="ef4">отображаются только те вещи,<br>которые доступны для ставки!</div>
                                    </div>
                                    <div class="search1">
                                        <div class="srh1" id="search_in_local_steam_inventory_srch"><input type="text" placeholder="Поиск по инвентарю" id="search_in_local_steam_inventory"><input type="submit" value=""></div>
                                        <div class="rr-sort1">
                                            <ul>
                                                <li>Сортировка:</li>
                                                <li id="local_inventory_sort_by_high_price" class="active"><a onclick="return SortLocalInventoryByLowPrice(36, 0);">Сперва дорогие</a></li>
                                                <li id="local_inventory_sort_by_low_price"><a href="" onclick="return SortLocalInventoryByLowPrice(36, 1);">Сперва дешевые</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="cont-ov-items-more1 jcheck more36" id="local_steam_inventory" style="min-height: 444px;" dt="0"></div>

                                    <div class="modal-page-s1" id="local_steam_inventory_pagination" style="display:none;">
                                        <ul>
                                            <li><a href="" onclick="return LocalInventory_GetFirstPage(36);" id="first">В начало</a></li>
                                            <li><a href="" onclick="return LocalInventory_GetBeforePage(36);" id="before">Предыдущая</a></li>
                                            <li><a href="" onclick="return LocalInventory_GetNextPage(36);" id="next">Следующая</a></li>
                                            <li><a href="" onclick="return LocalInventory_GetLastPage(36);" id="last">В конец</a></li>
                                        </ul>
                                    </div>

                                    <div class="ready-pp1" id="local_steam_inventory_loading">
                                        <div class="df-pp2 df-pp22">
                                            <img src="/cached_files/img/9-6_2_obrabotka-stavki_loading_icon.gif" alt=""><span class="j1">Идёт загрузка<br>инвентаря</span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="over-tt-item1">
                                <!-- CHIPS INVENTORY -->
                                <div class="ov-bl1">
                                    <div class="bg-ov-bl1"><div></div></div>
                                    <div class="tit-bl1">
                                        <div class="ef1">{{=Chips.Count}}</div>
                                        <div class="ef2">Суммарная<br>стоимость:</div>
                                        <div class="ef3">{{=PageData["ChipsTotalPrice"]}}</div>
                                        <div class="ef4">отображаются только те вещи,<br>которые доступны для ставки!</div>
                                    </div>
                                    <div class="search1">
                                        <div class="srh1"><input type="text" value="Поиск по инвентарю"><input type="submit" value=""></div>
                                        <div class="rr-sort1">
                                            <ul>
                                                <li>Сортировка:</li>
                                                <li class="active"><a href="">Сперва дорогие</a></li>
                                                <li><a>Сперва дешевые</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="cont-ov-items-more1 more36" id="chips_iventory">
                                        {{foreach(Chip Item in Chips.GetRange(0, Math.Min(60, Chips.Count)))}}
                                            <div class="item1" id="item_id_{{=Item.AssertID}}_3">
                                                <span style="display:none;" id="iventory_id">3</span>
                                                <span style="display:none;" id="current_iventory_id">3</span>
                                                <span style="display:none;" id="item_assert_id">{{=Item.AssertID}}</span>
                                                <span style="display:none;" id="item_id">{{=Item.ID}}</span>

                                                <img src="/chip-image/{{=Item.ID}}" alt="{{=Item.Cost_Str}}">
                                                <span class="" id="item_price">{{=Item.Cost_Str}}</span>
                                                <a href="" onclick="return hh({{=Item.AssertID}}, 3);"></a>
                                                <div class="tiltp">{{=Item.Cost_Str}}</div>
                                            </div>                                           
                                        {{end}}
                                    </div>
                                </div>
                            </div>                 
                        </div>
                    </div>
                    <div class="res1"></div>
                </div>
            </div>
            <div class="hh1-test"></div>
        </div>
    </div>
    <script>
        var UsersBetsPrice = parseFloat("{{=UsersBetsPrice}}");
        auth = true;

        function RubConvert(str) {
            return str.replace(/\d(?=(?:\d{3})+\b)/g, "$&" + ",");
        }

        var bet_count = 0;
        {{if(user.TradePartner == 0 || user.TradeToken.Length == 0)}}
        var trade_ok = false;
        {{end}}
        {{else}}
        var trade_ok = true;
        {{end}}

        var handler = false;
        var remove_from_cur_page = false;
        var cur_bet_price = 0;
        function hh(item_id, iven_id)
        {
            if(handler == false)
            {
                var itm_price = $("#item_id_" + item_id + "_" + iven_id + " span#item_price").text();
                if(itm_price.indexOf(',') > -1)
                {
                    itm_price = itm_price.replace(',', '');
                }
                itm_price = parseFloat(itm_price);

                var iventory_id = $("#item_id_" + item_id + "_" + iven_id + " span#iventory_id").text();
                var current_iventory_id = $("#item_id_" + item_id + "_" + iven_id + " span#current_iventory_id").text();
                /* 1: steam, 2: local, 0: bet, 3: fishka */
                if(current_iventory_id > 0)
                {
                    if(bet_count < 24) {
                        if(current_iventory_id == 1 && !trade_ok)
                        {
                            return false;
                        }

                        $("#item_id_" + item_id + "_" + iven_id + " span#current_iventory_id").text(0);
                        $("#item_id_" + item_id + "_" + iven_id).appendTo("div#bet_iventory");
                        bet_count++;
                        cur_bet_price += itm_price;
                    }
                }
                else 
                {
                    $("#item_id_" + item_id + "_" + iven_id + " span#current_iventory_id").text(iventory_id);

                    if(!remove_from_cur_page)
                    {
                        if(iventory_id == 1)
                            $("#item_id_" + item_id + "_" + iven_id).appendTo("div#steam_iventory");
                        else if(iventory_id == 2)
                            $("#item_id_" + item_id+ "_" + iven_id).appendTo("div#local_steam_inventory");
                        else if(iventory_id == 3)
                            $("#item_id_" + item_id+ "_" + iven_id).appendTo("div#chips_iventory");
                    }
                    else
                    {
                        $("#item_id_" + item_id+ "_" + iven_id).remove();
                    }
                    cur_bet_price = cur_bet_price - itm_price;
                    bet_count = bet_count -1;
                }

                $("#current_bet_price").text(RubConvert(cur_bet_price.toString()));
                $("#current_bet_items_num").text(bet_count);
                show_winrate();
            }
            return false;
        }

        function show_winrate()
        {
            var jc_Price = jackpot_price_str;
            if(jc_Price.indexOf(',') > -1)
            {
                jc_Price = jc_Price.replace(',', '');
            }
            jc_Price = parseFloat(jc_Price);

            var us_bets_price = UsersBetsPrice + cur_bet_price;
            if(us_bets_price > 0)
            {
                var win_rate_us = Math.round(us_bets_price / ((jc_Price + cur_bet_price) / 100));
                if(win_rate_us > 100){
                    $("#users_win_rate").text("100%");
                }
                else if(win_rate_us <= 0)
                {
                    $("#users_win_rate").text("1%");
                }
                else
                {                  
                    $("#users_win_rate").text(win_rate_us + "%");
                }

                console.log(us_bets_price + "| "+ jc_Price +"|" + win_rate_us);
            }
            else
            {
                $("#users_win_rate").text(0 + "%");
            }
        }

        function open_bet()
        {
            show_winrate();
            $("div#bet_sys").attr('style', 'display:block;');

            $('.cont-ov-items-more1 .item1,.ov-ic-more-s1 .item1,.over-items-more-bl1 .rr1 ,item1,.owl1 .item').each(function () {
                $(this).find('.tiltp').css({ 'margin-left': -($(this).find('.tiltp').width() * 0.5 + 10) })
            });
            return false;
        }

        function SetBet()
        {
            if(bet_count > 0 && bet_count <= 24)
            {
                handler = true;
                var inventory = $("div#bet_iventory");

                var bet = "LotteryPage{{=BaseFuncs.WSplit}}SetBet{{=BaseFuncs.WSplit}}" + LotteryPage_LotteryID + "{{=BaseFuncs.WSplit}}";
                $("div#bet_iventory div.item1" ).each(function( index ) 
                {
                    /*assert_id : item_type : item_id; */
                    var assert_id = $(" span#item_assert_id", this).text();
                    var item_type = $("span#iventory_id", this).text();
                    var item_id = $("span#item_id", this).text();

                    bet += assert_id + ":" + item_type + ":" + item_id + ";";
                });

                $("div#bet_ready").attr("style", "display:block;");
                ws.send(bet);
                console.log("ws bet sent");
                /*bet_count = 0;*/
            }

            return false;
        }
        var trade_url = "";

        $("document").ready(function () 
        {
            show_winrate();
            trade_url =  $("input#steam_trade_url").val();
            $("input#steam_trade_url").keyup(function () 
            {
                if($("input#steam_trade_url").val() == trade_url)
                {
                    $("span#trade_url_btn").attr("class", "active");
                }
                else
                {
                    $("span#trade_url_btn").attr("class", "");
                }
            });

            $('.cont-ov-items-more1 .item1,.ov-ic-more-s1 .item1,.over-items-more-bl1 .rr1 ,item1,.owl1 .item').each(function () {
                $(this).find('.tiltp').css({ 'margin-left': -($(this).find('.tiltp').width() * 0.5 + 10) })
            });
        });


        function UpdateTradeURL()
        {
            console.log("UpdateTradeURL{{=BaseFuncs.WSplit}}" + $("input#steam_trade_url").val());
            if($("span#trade_url_btn").attr("class") != "active"){
                ws.send("UpdateTradeURL{{=BaseFuncs.WSplit}}" + $("input#steam_trade_url").val());
            }
        }

        function try_again()
        {
            handler = false;
            $("div#bet_ready").attr("style", "display:none;");
            $("div#bet_done").attr("style", "display:none;");
            $("div#bet_wtf_error").attr("style", "display:none;");

            return false;
        }
    </script>
    {{end}}
    <div class="up1"></div>
</body>
</html>